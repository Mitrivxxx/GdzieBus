FROM oven/bun:1 AS build
WORKDIR /app
COPY web/ .
RUN bun install
RUN mkdir -p dist
RUN /bin/sh -lc 'if [ -f package.json ] && grep -q "\"build\"" package.json; then bun run build; else echo "no build script, skipping build"; fi'

FROM nginx:1.27-alpine
WORKDIR /usr/share/nginx/html
COPY --from=build /app/dist .
COPY nginx/nginx.conf /etc/nginx/nginx.conf
